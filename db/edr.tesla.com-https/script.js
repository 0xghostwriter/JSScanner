var input_file=u("input#file"),file_upload_div=u("div#file-upload"),form=u("form#file-upload-form"),select_file_text_span=u(".selected-file span"),error_message_alert=u("#error-message"),success_message_alert=u("#success-message"),submit_form_button=u("#submit-button"),input_file_label=u("input#file").find("label"),upload_file_label=u("label#upload-file-label"),original_submit_file_button_clone=submit_form_button.clone(),label=file_upload_div.find("label"),labelVal=label.text(),strings={BUTTON_UPLOAD_SECOND_FILE:"Upload another file",BUTTON_UPLOAD_INITIAL_FILE:"Select a file to upload",BUTTON_DOWNLOAD_REPORT:"Download Report",HELPER_SELECT_FILE:"Select a file",ERR_DEFAULT_JSON_PARSE:"Error parsing response JSON",ERR_DEFAULT:"An error has occured"};function init(){input_file=u("input#file"),select_file_text_span=u(".selected-file span"),error_message_alert=u("#error-message"),success_message_alert=u("#success-message"),submit_form_button=u("#submit-button"),input_file_label=u("input#file").find("label"),upload_file_label=u("label#upload-file-label")}function hide_alerts(){hide_errors(),hide_successes()}function reset_selected_file_text(){select_file_text_span.text(strings.HELPER_SELECT_FILE).addClass("oblique")}function hide_errors(){error_message_alert.addClass("hidden")}function show_error(e){error_message_alert.toggleClass("hidden"),error_message_alert.find("span").text(e)}function show_success(e){success_message_alert.removeClass("hidden"),success_message_alert.find("span").text(e)}function hide_successes(e){success_message_alert.addClass("hidden"),success_message_alert.find("span").text(e)}function toggle_loading_animation(e){var t=u(".section-loader");e&&!0===e?t.removeClass("invisible"):e&&!1===e?t.addClass("invisible"):t.toggleClass("invisible")}function change_selected_file(e){submit_form_button.removeClass("disabled"),change_filename_displayed(e)}function reset_form_state(){var e=document.getElementById("file-upload-form");reset_selected_file_text(),u("#submit-button").replace(original_submit_file_button_clone),submit_form_button.attr("disabled","disabled"),error_message_alert.addClass("hidden"),error_message_alert.find("span").text(""),e.reset()}function change_filename_displayed(e){e?(select_file_text_span.removeClass("oblique"),select_file_text_span.text(e)):(select_file_text_span.addClass("oblique"),select_file_text_span.text(strings.HELPER_SELECT_FILE))}function create_download_button(e){var t,s;(t=document.createElement("a")).setAttribute("id","download-button"),u("#submit-button").replace(t),(s=u("#download-button")).text(strings.BUTTON_DOWNLOAD_REPORT),s.addClass("btn-primary"),s.attr("href",e.href),s.attr("download",e.download),s.on("click",download_button_handler)}function download_button_handler(e){upload_file_label.text(strings.BUTTON_UPLOAD_INITIAL_FILE)}function toggle_submit_or_download_button(e,t){e&&!0===e?(submit_form_button.text("Submit"),submit_form_button.attr("type","submit"),submit_form_button.first().removeAttribute("disabled"),submit_form_button.on("click",submit_form_handler)):create_download_button(t)}function submit_form_handler(e){return e.preventDefault(),document.getElementById("file-upload-form").submit(),!1}function toggle_button_disabled(e,t){e.disabled=void 0===t?!e.disabled:t}function submit_form(){var e=document.getElementById("file-upload-form"),t=new FormData(e),s=new XMLHttpRequest;toggle_loading_animation(!0),s.open("POST",e.getAttribute("action"),!0),s.onreadystatechange=function(){if(s.readyState===XMLHttpRequest.DONE&&200===s.status){var e=JSON.parse(s.responseText);e.body&&e.body.statusURL&&start_poll(e.body.statusURL)}else if(s.readyState===XMLHttpRequest.DONE&&200!==s.status){var t=JSON.parse(s.responseText);toggle_loading_animation(!1),show_error(t.body.message)}},s.send(t)}function start_poll(e){var t=setInterval(function(){poll(e,function(e,s){"done"===e?(clearInterval(t),toggle_loading_animation(!1),toggle_button_disabled(input_file,!0),toggle_submit_or_download_button(!1,{href:s.href,download:s.download})):"error"===e&&(clearInterval(t),toggle_loading_animation(!1))})},5e3)}function poll(e,t){var s=select_file_text_span.text(),n=new XMLHttpRequest;n.open("GET",e,!0),n.onload=function(){var e;try{e=JSON.parse(n.responseText)}catch(t){e={body:{message:strings.ERR_DEFAULT_JSON_PARSE}}}if(n.status>=200&&n.status<400){if("done"===(e=e.body).status)return t(e.status,{href:e.statusURL,download:s+".pdf"})}else if(e.body&&e.body.message)return show_error(e.body.message),t("error")},n.onerror=function(){return toggle_loading_animation(!1),t("error")},n.send()}function ensure_original_submit_button(){var e=u("#submit-button-wrapper"),t=e.find("#submit-button"),s=e.find("#download-button");t&&0!==t.length||(s&&1===s.length?s.replace(original_submit_file_button_clone):e.append(original_submit_file_button_clone))}form.on("submit",function(e){return e.preventDefault(),submit_form(),!1}),form.onsubmit=function(e){return e.preventDefault(),submit_form(),!1},input_file.on("click",function(e){ensure_original_submit_button()}),input_file.on("change",function(e){e.preventDefault(),hide_errors();var t=this.files?e.target.value.split("\\").pop():"";return t&&(change_selected_file(t),(submit_form_button=u("#submit-button")).first().removeAttribute("disabled")),!1}),u("#reset_form").on("click",function(){reset_form_state()}),u('[data-trigger="close"]').on("click",function(){hide_alerts()});